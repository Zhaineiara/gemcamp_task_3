<div class="container mt-5">
  <div class="row">
    <!-- Left Column: Movie Information -->
    <div class="col-md-6">
      <div class="card shadow-sm border-light" style="max-width: 600px; width: 100%; background-color: #f8f9fa;">
        <div class="card-header bg-primary text-white text-center">
          <h2 class="mb-0">Movie Information</h2>
        </div>
        <div class="card-body">
          <p class="card-text"><strong>Title:</strong> <%= @movie.title || '-' %></p>
          <p class="card-text"><strong>Description:</strong> <%= @movie.description || '-' %></p>
          <p class="card-text"><strong>Date
            Released:</strong> <%= @movie.date_released.present? ? @movie.date_released.strftime('%B %d, %Y') : '-' %>
          </p>
          <p class="card-text"><strong>Country of Origin:</strong> <%= @movie.country_of_origin || '-' %></p>
          <p class="card-text"><strong>Showing
            Start:</strong> <%= @movie.showing_start.present? ? @movie.showing_start.strftime('%B %d, %Y %I:%M %p') : '-' %>
          </p>
          <p class="card-text"><strong>Showing
            End:</strong> <%= @movie.showing_end.present? ? @movie.showing_end.strftime('%B %d, %Y %I:%M %p') : '-' %>
          </p>
          <p class="card-text">
            <strong>Genres:</strong> <%= @movie.genres.any? ? @movie.genres.map(&:name).join(', ') : '-' %></p>
        </div>

        <div class="card-footer d-flex justify-content-between align-items-center">
          <% if user_signed_in? %>
            <%= link_to "Add Review", new_movie_review_path(@movie), class: "btn btn-primary" %>
            <% if @movie.user_id == current_user.id %>
              <div class="text-center">
                <%= link_to '<i class="bi bi-pencil-fill small-icon"></i>'.html_safe, edit_movie_path(@movie), class: "btn btn-secondary", title: "Edit" %>
                <%= link_to '<i class="bi bi-trash-fill small-icon"></i>'.html_safe, movie_path(@movie), class: "btn btn-danger", data: { bs_toggle: "modal", bs_target: "#deleteModal#{@movie.id}" }, title: "Delete" %>

                <!-- Modal -->
                <div class="modal fade" id="deleteModal<%= @movie.id %>" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        Are you sure you want to delete this movie?
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <%= button_to '<i class="bi bi-trash-fill small-icon"></i>'.html_safe, movie_path(@movie), method: :delete, class: "btn btn-danger", title: "Delete" %>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          <% end %>

          <%= link_to 'Back to Movies', movies_path, class: 'btn btn-secondary' %>
        </div>
      </div>
    </div>

    <div class="p-5 text-primary-emphasis bg-primary-subtle w-50 card shadow-sm border-light">
      <!-- Right Column: Reviews -->
      <div class="col-md-10 mt-4 mt-md-0 mx-auto">
        <h3 class="text-center mb-4">Reviews</h3>

        <div class="text-center mb-3 ">
          <h5 class="d-inline">
            Average Rating:
            <%= @movie.reviews.any? ? @movie.reviews.average(:rating)&.round(1) : 'N/A' %> / 5
          </h5>
          <span class="badge bg-secondary ms-2"><%= @movie.reviews.count %> Comments</span>
        </div>

        <div style="max-height: 400px; overflow-y: auto;">
          <% if @movie.reviews.any? %>
            <% @movie.reviews.order(rating: :desc).each do |review| %>
              <div class="card mb-2 shadow-sm border-light" style="max-width: 400px; margin: auto;">
                <div class="card-body p-2">
                  <p class="mb-1">
                    <strong><%= "#{review.user.first_name} #{review.user.last_name}" %></strong>
                  </p>

                  <p class="mb-1">
                    <strong>Rating:</strong> <%= review.rating %> / 5
                  </p>

                  <p class="mb-1 text-muted">
                    <small>Reviewed on <%= review.created_at.strftime('%B %d, %Y') %></small>
                  </p>

                  <p class="card-text mt-2" style="font-size: 0.9rem;">
                    <%= review.comment %>
                  </p>

                  <% if user_signed_in? && review.user_id == current_user.id %>
                      <p class="card-text mt-2 position-absolute bottom-0 end-0">
                        <%= link_to '<i class="bi bi-pencil-fill"></i>'.html_safe, edit_movie_path(@movie), class: "btn btn-secondary", title: "Edit" %>
                        <%= link_to '<i class="bi bi-trash-fill"></i>'.html_safe, movie_path(@movie), class: "btn btn-danger", data: { bs_toggle: "modal", bs_target: "#deleteModal#{@movie.id}" }, title: "Delete" %>
                      </p>
                  <% end %>
                </div>
              </div>

            <% end %>
          <% else %>
            <p class="text-center">There are no reviews for this movie yet.</p>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>